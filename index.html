<head>
    <title>地下城-奧利哈鋼</title>
    <link rel="icon" type="image/png" href="Orichalcum.png">
    <link rel="stylesheet" href="style.css?v=2.0">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<div id="custom-modal-backdrop" style="display: none;">
    <div id="update-log-modal" class="panel">

        <h3 id="modal-title" style="color: #f39c12; margin-top: 0;"></h3>

        <div id="codex-filters" style="margin-bottom: 15px; text-align: center; display: none;">
            <button data-filter="weapon">⚔️ 武器</button>
            <button data-filter="armor">🛡️ 胸甲</button>
            <button data-filter="helmet">🪖 頭盔</button>
            <button data-filter="greaves">👢 護脛</button>
            <button data-filter="necklace">📿 項鍊</button>
            <button data-filter="ring">💍 戒指</button>
            <button data-filter="consumable">🧪 藥水</button>
            <button data-filter="special">💎 特殊</button>
            <button data-filter="all">所有道具</button>
        </div>

        <div id="modal-content">
        </div>
        <button id="modal-close-btn" style="margin-top: 15px;">確定</button>
    </div>
</div>


<!-- Boss 選擇模態框 -->
<div id="boss-selection-modal-backdrop"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); justify-content: center; align-items: center; z-index: 1015;">
    <div id="boss-selection-modal" class="panel"
        style="position: relative; background: #2a1f1f; border: 3px solid #f39c12; padding: 30px; border-radius: 10px; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto; text-align: center; box-shadow: 0 0 25px rgba(243, 156, 18, 0.6);">

        <!-- X 關閉按鈕 -->
        <button id="boss-selection-close-btn"
            style="position: absolute; top: 15px; right: 15px; background: none; border: none; color: #f39c12; font-size: 2em; line-height: 1; cursor: pointer; padding: 0; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease;"
            onmouseover="this.style.color='#ff0000'; this.style.transform='scale(1.2)'"
            onmouseout="this.style.color='#f39c12'; this.style.transform='scale(1)'">
            ×
        </button>

        <h3 style="color: #f39c12; margin-top: 0; font-size: 1.8em;">🔥 選擇挑戰目標 🔥</h3>

        <p style="color: #ddd; margin: 10px 0 20px 0;">請選擇要挑戰的Boss</p>

        <div id="boss-list-container" style="display: flex; flex-direction: column; gap: 15px;">
            <!-- Boss 列表將由 JavaScript 動態生成 -->
        </div>
    </div>
</div>

<div id="dungeon-challenge-modal-backdrop"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); justify-content: center; align-items: center; z-index: 1010;">
    <div id="dungeon-challenge-modal" class="panel"
        style="background: #3d3326; border-color: #f39c12; padding: 30px; border-radius: 10px; max-width: 400px; width: 90%; text-align: center; box-shadow: 0 0 20px rgba(243, 156, 18, 0.4);">

        <h3 id="dungeon-challenge-title" style="color: #f39c12; margin-top: 0;">🔥 期間限時挑戰 🔥</h3>

        <p id="dungeon-challenge-info" style="margin: 15px 0 25px 0;">
            你確定要挑戰這個強大的 Boss 嗎？你將面對一場沒有退路的戰鬥！
        </p>

        <div style="display: flex; justify-content: center;">

            <div id="dungeon-challenge-btn-group" style="display: flex; justify-content: space-around; width: 100%;">
                <button id="dungeon-challenge-btn"
                    style="background-color: #e74c3c; border-color: #ff8888; min-width: 120px;">
                    ⚔️ 挑戰
                </button>
                <button id="dungeon-leave-btn" style="background-color: #666; border-color: #aaa; min-width: 120px;">
                    🚪 離開
                </button>
            </div>

            <div id="dungeon-defeat-btn-group" style="display: none; width: 100%;">
                <button id="dungeon-defeat-leave-btn"
                    style="background-color: #666; border-color: #aaa; min-width: 120px; margin: 0 auto;">
                    🚪 離開
                </button>
            </div>
        </div>
    </div>
</div>
</div>

<!-- 挑戰系統選擇模態框 (藍紫色主題) -->
<div id="challenge-selection-modal-backdrop"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); justify-content: center; align-items: center; z-index: 1015;">
    <div id="challenge-selection-modal" class="panel"
        style="position: relative; background: linear-gradient(135deg, #1a0a30 0%, #2a1540 100%); border: 3px solid #8b5cf6; padding: 30px; border-radius: 10px; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto; text-align: center; box-shadow: 0 0 25px rgba(139, 92, 246, 0.6);">

        <!-- X 關閉按鈕 -->
        <button id="challenge-selection-close-btn"
            style="position: absolute; top: 15px; right: 15px; background: none; border: none; color: #a78bfa; font-size: 2em; line-height: 1; cursor: pointer; padding: 0; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease;"
            onmouseover="this.style.color='#ff0000'; this.style.transform='scale(1.2)'"
            onmouseout="this.style.color='#a78bfa'; this.style.transform='scale(1)'">
            ×
        </button>

        <h3 style="color: #a78bfa; margin-top: 0; font-size: 1.8em;">⚡ 選擇挑戰目標 ⚡</h3>

        <p style="color: #ddd; margin: 10px 0 20px 0;">選擇要挑戰的強大boss</p>

        <div id="challenge-boss-list-container" style="display: flex; flex-direction: column; gap: 15px;">
            <!-- Boss 列表將由 JavaScript 動態生成 -->
        </div>
    </div>
</div>

<!-- 販賣數量選擇模態框 -->
<div id="sell-quantity-modal-backdrop"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); z-index: 9999; justify-content: center; align-items: center;">
    <div id="sell-quantity-modal"
        style="position: relative; background: linear-gradient(135deg, #2a1a1a 0%, #1a1515 100%); border: 2px solid #f39c12; padding: 30px; border-radius: 10px; max-width: 450px; width: 90%; text-align: center; box-shadow: 0 0 30px rgba(243, 156, 18, 0.6);">

        <!-- 關閉按鈕 -->
        <button id="sell-quantity-close-btn"
            style="position: absolute; top: 15px; right: 15px; background: none; border: none; color: #f39c12; font-size: 2em; cursor: pointer; padding: 0; width: 40px; height: 40px; line-height: 1; transition: all 0.3s ease;"
            onmouseover="this.style.color='#e74c3c'; this.style.transform='scale(1.2)'"
            onmouseout="this.style.color='#f39c12'; this.style.transform='scale(1)'">
            ×
        </button>

        <h3 style="color: #f39c12; margin-top: 0; margin-bottom: 20px;">💰 選擇販賣數量</h3>

        <div id="sell-quantity-item-info"
            style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <div style="font-size: 1.2em; color: #ddd; margin-bottom: 10px;">
                <span id="sell-quantity-item-name">物品名稱</span>
            </div>
            <div style="color: #95a5a6; font-size: 0.9em;">
                持有數量: <span id="sell-quantity-current-count" style="color: #3498db; font-weight: bold;">0</span>
            </div>
        </div>

        <div style="margin: 25px 0;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <span style="color: #ddd;">販賣數量:</span>
                <span id="sell-quantity-value" style="color: #f39c12; font-size: 1.5em; font-weight: bold;">1</span>
            </div>

            <input type="range" id="sell-quantity-slider" min="1" max="1" value="1"
                style="width: 100%; height: 8px; border-radius: 5px; outline: none; background: linear-gradient(to right, #f39c12 0%, #f39c12 0%, #555 0%, #555 100%); cursor: pointer;">

            <style>
                #sell-quantity-slider::-webkit-slider-thumb {
                    -webkit-appearance: none;
                    appearance: none;
                    width: 20px;
                    height: 20px;
                    border-radius: 50%;
                    background: #f39c12;
                    cursor: pointer;
                    box-shadow: 0 0 10px rgba(243, 156, 18, 0.8);
                }

                #sell-quantity-slider::-moz-range-thumb {
                    width: 20px;
                    height: 20px;
                    border-radius: 50%;
                    background: #f39c12;
                    cursor: pointer;
                    box-shadow: 0 0 10px rgba(243, 156, 18, 0.8);
                    border: none;
                }
            </style>

            <div
                style="display: flex; justify-content: space-between; color: #95a5a6; font-size: 0.85em; margin-top: 5px;">
                <span>1</span>
                <span id="sell-quantity-max">1</span>
            </div>
        </div>

        <div
            style="background: rgba(255, 215, 0, 0.1); padding: 12px; border-radius: 8px; border: 1px solid rgba(255, 215, 0, 0.3); margin-bottom: 20px;">
            <div style="color: #f1c40f; font-size: 0.9em; margin-bottom: 5px;">💰 預計收益</div>
            <div id="sell-quantity-total-price" style="color: #f39c12; font-size: 1.3em; font-weight: bold;">0 金幣</div>
        </div>

        <div style="display: flex; gap: 15px; justify-content: center;">
            <button id="sell-quantity-confirm-btn"
                style="background-color: #27ae60; border-color: #2ecc71; min-width: 120px; padding: 12px 24px; font-size: 1em; font-weight: bold;">
                ✓ 確認販賣
            </button>
            <button id="sell-quantity-cancel-btn"
                style="background-color: #666; border-color: #aaa; min-width: 120px; padding: 12px 24px; font-size: 1em;">
                ✗ 取消
            </button>
        </div>
    </div>
</div>

<div id="evolution-confirm-modal-backdrop"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); justify-content: center; align-items: center; z-index: 1045;">
    <div id="evolution-confirm-modal" class="panel"
        style="background: #2c0e36; border-color: #9b59b6; padding: 30px; border-radius: 10px; max-width: 400px; width: 90%; text-align: center; box-shadow: 0 0 20px rgba(155, 89, 182, 0.4);">

        <h3 style="color: #d2b4de; margin-top: 0;">✨ 挑戰轉職試煉 ✨</h3>

        <p style="margin: 15px 0 25px 0; color: #ddd;">
            你即將挑戰內心的恐懼。<br>這場戰鬥將決定你是否有資格晉升。<br>準備好了嗎？
        </p>

        <div style="display: flex; justify-content: center; gap: 20px;">
            <button id="evolution-confirm-btn"
                style="background-color: #8e44ad; border-color: #a569bd; min-width: 120px;">
                ⚔️ 開始挑戰
            </button>
            <button id="evolution-cancel-btn" style="background-color: #666; border-color: #aaa; min-width: 120px;">
                🚪 稍後再說
            </button>
        </div>
    </div>
</div>

<!-- 回歸玉確認模態框 -->
<div id="return-jewel-modal-backdrop"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); justify-content: center; align-items: center; z-index: 1045;">
    <div id="return-jewel-modal" class="panel"
        style="background: linear-gradient(135deg, #2c0e36 0%, #1a0a20 100%); border: 3px solid #d4af37; padding: 30px; border-radius: 10px; max-width: 450px; width: 90%; text-align: center; box-shadow: 0 0 30px rgba(212, 175, 55, 0.6);">

        <h3 style="color: #d4af37; margin-top: 0; font-size: 1.8em;">🔮 使用回歸玉 🔮</h3>

        <div
            style="margin: 20px 0; padding: 20px; background: rgba(0, 0, 0, 0.3); border-radius: 8px; border: 1px solid #d4af37;">
            <p style="margin: 10px 0; color: #f1c40f; font-size: 1.1em; font-weight: bold;">⚠️ 重要提示</p>
            <p style="margin: 15px 0; color: #ddd; line-height: 1.6;">
                使用後您將<span style="color: #e74c3c; font-weight: bold;">重新選擇職業</span>，<br>
                但需再歷練<span style="color: #f39c12; font-weight: bold;">500層</span>才能再次轉職。
            </p>
            <p style="margin: 15px 0; color: #95a5a6; font-size: 0.9em;">
                此操作不可逆，請謹慎考慮！
            </p>
        </div>

        <p style="margin: 20px 0 25px 0; color: #ecf0f1; font-size: 1.1em;">
            確定要使用回歸玉嗎？
        </p>

        <div style="display: flex; justify-content: center; gap: 20px;">
            <button id="return-jewel-confirm-btn"
                style="background: linear-gradient(#27ae60, #229954); border-color: #27ae60; min-width: 120px; font-size: 1.1em; padding: 12px 25px;">
                ✓ 確定
            </button>
            <button id="return-jewel-cancel-btn"
                style="background: linear-gradient(#e74c3c, #c0392b); border-color: #e74c3c; min-width: 120px; font-size: 1.1em; padding: 12px 25px;">
                ✗ 取消
            </button>
        </div>
    </div>
</div>

<div id="class-evolution-modal-backdrop"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); justify-content: center; align-items: center; z-index: 1050;">
    <div id="class-evolution-modal" class="panel"
        style="background: #2c3e50; border-color: #3498db; padding: 30px; border-radius: 10px; max-width: 600px; width: 95%; text-align: center; box-shadow: 0 0 25px rgba(52, 152, 219, 0.6);">

        <h3 id="evolution-title" style="color: #3498db; margin-top: 0; font-size: 1.8em;">✨ 靈魂昇華 ✨</h3>

        <p id="evolution-desc" style="margin: 15px 0 25px 0; color: #ecf0f1; font-size: 1.1em;">
            你的靈魂經歷了千百次的磨練，現在已經準備好邁向更高的境界。<br>
            請選擇你的新道路...
        </p>

        <div id="evolution-options" style="display: flex; justify-content: space-around; gap: 20px; flex-wrap: wrap;">
            <!-- 選項將由 JS 動態生成 -->
        </div>
    </div>
</div>

<body>
    <div class="game-container">

        <div id="auth-area" class="panel">
            <div style="display: flex; justify-content: space-between; align-items: center; gap: 15px;">
                <h3>👤 帳號管理

                    <div id="logged-out-view">
                        <p style="margin-bottom: 10px;">請輸入帳號密碼來登入或創建帳號：</p>

                        <div style="margin-bottom: 8px;">
                            <label for="username-input">帳號：</label>
                            <input type="text" id="username-input" placeholder="請輸入帳號" required>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label for="password-input">密碼：</label>
                            <input type="password" id="password-input" placeholder="請輸入密碼" required>
                        </div>

                        <button id="login-btn" style="background-color: #3498db; margin-right: 15px;">登入</button>

                        <button id="create-account-btn" style="background-color: #2ecc71;">創建帳號</button>

                        <div style="margin-top: 10px; font-size: 0.9em;">
                            <a href="#" onclick="alert('請聯繫管理員重設密碼'); return false;">忘記密碼？</a>
                        </div>
                    </div>

                    <div id="logged-in-view" style="display: none;">
                        <p>歡迎回來，<span id="current-username"></span>！</p>
                        <button id="logout-btn">登出</button>
                    </div>

                </h3>

                <div id="top-central-adventures"
                    style="margin-bottom: 15px; display: none; width: 100%; display: flex; justify-content: center; flex-direction: row; gap: 10px; align-items: stretch;">

                    <div id="evolution-challenge-panel" class="panel"
                        style="text-align: center; background: #2c0e36; border-color: #9b59b6; padding: 15px; min-width: 250px; height: 100px; margin-bottom: 0px; display: none; box-shadow: 0 0 15px #9b59b6; flex-direction: column; justify-content: space-between;">

                        <div>
                            <h3 style="color: #d2b4de; margin: 0 0 10px 0;">✨ 靈魂的呼喚 ✨</h3>
                            <p style="color: #ddd;">靈魂的昇華之路</p>
                        </div>

                        <button id="evolution-challenge-btn"
                            style="background-color: #8e44ad; border-color: #a569bd; margin-top: 15px; min-width: 250px; width: 100%; font-weight: bold; height: 45px;">
                            ⚔️ 挑戰轉職試煉
                        </button>
                    </div>

                    <div id="dungeon-entrance-panel" class="panel"
                        style="text-align: center; background: #331f1f; border-color: #7b4e4e; padding: 15px; max-width: 450px; height: 100px; display: flex; flex-direction: column; justify-content: space-between; box-shadow: 0 0 15px rgba(255, 85, 85, 0.5);">

                        <div>
                            <h3>🚨 試煉之門 🚨</h3>
                            <p>挑戰強大的Boss 獲得稀有道具和素材</p>
                        </div>

                        <button id="dungeon-enter-btn"
                            style="background-color: #8c0000; border-color: #ff5555; margin-top: 15px; min-width: 150px; width: 100%; font-weight: bold; height: 45px;">
                            🔥 前往挑戰
                        </button>
                    </div>

                    <div id="challenge-entrance-panel" class="panel"
                        style="text-align: center; background: #1a0a30; border-color: #8b5cf6; padding: 15px; min-width: 270px; height: 100px; display: none; flex-direction: column; justify-content: space-between; box-shadow: 0 0 15px rgba(139, 92, 246, 0.5);">

                        <div>
                            <h3 style="color: #a78bfa;">🌕 舊日 🌑</h3>
                            <p style="color: #ddd;">探索未知</p>
                        </div>

                        <button id="challenge-enter-btn"
                            style="background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%); border: 2px solid #a78bfa; margin-top: 15px; min-width: 150px; width: 100%; font-weight: bold; height: 45px; color: white;">
                            ⚔️ 進入虛界
                        </button>
                    </div>
                </div>

                <div style="display: flex; flex-direction: column; align-items: flex-end;">

                    <button id="how-to-play-btn"
                        style="padding: 5px 10px; font-size: 0.9em; background-color: #f39c12; color: white; margin-top: 10px;">
                        ❓ 遊戲提示
                    </button>

                    <button id="update-log-btn"
                        style="padding: 5px 10px; font-size: 0.9em; background-color: #2ecc71; color: white; margin-top: 10px;">
                        📢 更新日誌
                    </button>

                    <button id="codex-toggle-btn"
                        style="padding: 5px 10px; font-size: 0.9em; background-color: #7f8c8d; color: white; margin-top: 10px;">
                        📜 道具圖鑑
                    </button>

                    <button id="achievements-toggle-btn"
                        style="padding: 5px 10px; font-size: 0.9em; background-color: #e67e22; color: white; margin-top: 10px; display: none;">
                        🏆 成就列表
                    </button>

                </div>
            </div>
        </div>

        <div id="game-content" style="display: none;">
            <div id="codex-panel" class="panel" style="display: none;">
                <h3>📜 道具圖鑑</h3>
                <div id="codex-list" style="display: flex; flex-wrap: wrap; gap: 15px;">
                </div>
                <button id="close-codex-btn">關閉圖鑑</button>
            </div>

            <div class="game-layout">

                <div id="status-display" class="panel">
                    <h3>⚔️ 冒險家狀態</h3>

                    <div id="status-flex-container"
                        style="display: flex; flex-direction: row; gap: 15px; align-items: stretch;">
                        <div id="status-stats-container" style="flex: 1;">
                            <p style="margin-top: 0;">職業 : <span id="class-name-value"
                                    style="color: #f1c40f; font-weight: bold;">無</span></p>
                            <p>HP : <span id="hp-value">0</span> / <span id="max-hp-value">0</span></p>
                            <p>ATK : <span id="attack-value">0</span></p>
                            <p>DEF : <span id="defense-value">0</span></p>
                            <p>暴擊率 : <span id="crit-chance-value">0%</span></p>
                            <p>金幣 : <span id="gold-value">0</span></p>
                            <p>深度 : <span id="depth-value">0</span> 層</p>
                            <p>耀魂石 : <span id="stones-value">0</span> </p>
                        </div>

                        <!-- 裝備顯示區塊 - 只在打開背包時顯示 -->
                        <div id="equipped-items-display"
                            style="display: none; flex: 1; padding-left: 10px; border-left: 2px solid #6e5a3d;">
                            <h4 style="margin: 0 0 10px 0; color: #f1c40f;">⚔️ 當前裝備</h4>
                            <p>武器 : <span id="equipped-weapon-name">無</span></p>
                            <p>頭盔 : <span id="equipped-helmet-name">無</span></p>
                            <p>胸甲 : <span id="equipped-armor-name">無</span></p>
                            <p>護脛 : <span id="equipped-greaves-name">無</span></p>
                            <p>項鍊 : <span id="equipped-necklace-name">無</span></p>
                            <p>戒指 : <span id="equipped-ring-name">無</span></p>
                        </div>
                    </div>

                    <button id="inventory-btn">背包</button>
                </div>

                <!-- 🔨 鍛造台區域 -->
                <div id="crafting-access-panel" class="panel"
                    style="display: none; background: linear-gradient(135deg, #2a1f15 0%, #1a1410 100%); border: 2px solid #d4af37; padding: 15px; cursor: pointer; transition: all 0.3s ease;">
                    <h3 style="margin: 0 0 8px 0; color: #d4af37; font-size: 1.1em; text-align: center;">🔨 鍛造台</h3>
                    <p style="margin: 0; font-size: 0.85em; color: #bbb; text-align: center;">點擊開啟合成介面</p>
                </div>

                <!-- 裝備展示面板 (新增) -->
                <div id="visual-equipment-display" class="panel" style="display: none;">
                    <h3>🛡️ 裝備展示</h3>
                    <div class="equipment-grid">
                        <div class="equipment-slot" data-slot="weapon" title="武器"></div>
                        <div class="equipment-slot" data-slot="helmet" title="頭盔"></div>
                        <div class="equipment-slot" data-slot="armor" title="胸甲"></div>
                        <div class="equipment-slot" data-slot="greaves" title="護脛"></div>
                        <div class="equipment-slot" data-slot="necklace" title="項鍊"></div>
                        <div class="equipment-slot" data-slot="ring" title="戒指"></div>
                    </div>
                </div>


                <!-- 🔨 合成/鍛造面板 (模态框) -->
                <div id="crafting-panel"
                    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 1000; align-items: center; justify-content: center;">
                    <div class="panel"
                        style="max-width: 600px; max-height: 80vh; overflow-y: auto; margin: auto; background: #1a1410; border: 2px solid #d4af37; padding: 20px;">
                        <h3 style="color: #d4af37; text-align: center;">🔨 鍛造台</h3>
                        <p style="font-size: 0.9em; color: #bbb; margin-bottom: 10px; text-align: center;">
                            收集特殊道具即可合成強大武器</p>
                        <div id="crafting-recipes-list">
                            <!-- 動態生成配方列表 -->
                        </div>
                        <button id="close-crafting-btn" style="margin-top: 15px; width: 100%;">關閉鍛造台</button>
                    </div>
                </div>

                <div id="hub-area" class="panel">
                    <h3>🏰 城鎮</h3>

                    <div id="shop-area" class="panel">
                        <h3>💰 雜貨鋪</h3>
                        <div id="shop-inventory-list">正在載入商品...</div>
                    </div>

                    <div id="stone-exchange" class="panel" style="border: 1px dashed #aaa;">
                        <h4>✨ 耀魂石兌換所 (10 💰 : 1 💎)</h4>
                        <input type="number" id="gold-amount-input" value="100" min="10" step="10" style="width: 80px;">
                        <button id="exchange-btn">兌換</button>
                        <span>可兌換 <span id="exchange-result">10</span> 💎</span>
                    </div>

                    <div style="margin-top: 15px;">
                        <div id="upgrade-multiplier-controls" style="margin-bottom: 10px;">
                            <span>升級倍率: </span>
                            <button class="multiplier-btn active" data-value="1">x1</button>
                            <button class="multiplier-btn" data-value="10">x10</button>
                            <button class="multiplier-btn" data-value="MAX">Max</button>
                        </div>

                        <span class="nowrap-text">使用耀魂石強化你的能力：</span>
                        <button id="upgrade-hp-btn">永久 HP+5</button>
                        <button id="upgrade-attack-btn">永久 ATK+5</button>
                        <button id="upgrade-defense-btn">永久 DEF+5</button>
                    </div>
                </div>

                <div id="log-and-controls-group">

                    <div id="game-log" class="panel log">
                        <h3>📜 冒險日誌</h3>

                        <!-- Merged Combat UI -->
                        <div id="combat-area"
                            style="display: none; border-bottom: 1px dashed #666; padding-bottom: 10px; margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-weight: bold; color: #e74c3c; font-size: 1.1em;">⚔️ <span
                                        id="monster-name">[怪物名稱]</span></span>
                                <span style="font-size: 0.9em; color: #ccc;">ATK:<span
                                        id="monster-attack-value">0</span> DEF:<span
                                        id="monster-defense-value">0</span></span>
                            </div>

                            <div style="display: flex; align-items: center; gap: 10px; margin-top: 5px;">
                                <span style="font-size: 0.9em;">HP: <span id="monster-hp-value">0</span>/<span
                                        id="monster-max-hp-value">0</span></span>
                                <div
                                    style="flex: 1; background: #555; height: 12px; border-radius: 6px; overflow: hidden;">
                                    <div id="monster-hp-bar" style="width: 100%; background: #e74c3c; height: 100%;">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="messages">歡迎來到地下世界！</div>
                    </div>

                    <div id="controls-area" class="panel">
                        <h3 id="current-stage-title">行動</h3>

                        <div id="class-selection" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                            <button id="select-knight-btn" style="width: 100%; min-width: 0;">🛡️
                                騎士<br>+50HP<br>+20DEF</button>
                            <button id="select-merchant-btn" style="width: 100%; min-width: 0;">💰
                                商人<br>+200金幣<br>-20%暴擊率</button>
                            <button id="select-thief-btn" style="width: 100%; min-width: 0;">🗡️
                                刺客<br>+25ATK<br>+20%暴擊率</button>

                        </div>

                        <div id="adventure-actions">

                            <div id="explore-mode-buttons">
                                <button id="explore-btn" style="font-size: 1.2em;">🎲 繼續探險</button>
                                <button id="rest-btn">⛺ 確認回城步數</button>
                            </div>
                        </div>

                        <div id="combat-mode-buttons" style="display: none;">
                            <button id="attack-btn" style="background-color: #e74c3c;">⚔️ 攻擊</button>
                            <button id="run-btn" style="background-color: #f39c12;">🏃 逃跑</button>
                        </div>

                        <div id="death-mode-buttons" style="display: none;">
                            <button id="revive-btn" style="background-color: #3498db; font-size: 1.2em;">🔙 回到城鎮
                                (復原進度)</button>
                        </div>

                    </div>


                </div>

                <!-- 新增：視覺化裝備面板 (中間欄) -->
                <div id="visual-equipment-panel" class="panel"
                    style="display: none; flex: 0.8; flex-direction: column; align-items: center; padding-top: 0; min-width: 160px; background: #2f2519; border-color: #8c704c; margin-left: 15px; margin-right: 15px;">
                    <h3
                        style="margin-top: 0; margin-bottom: 15px; color: #f1c40f; width: 100%; text-align: center; border-bottom: 2px solid #5a4632; padding-bottom: 5px;">
                        裝備</h3>

                    <div class="equipment-slots-container"
                        style="display: flex; flex-direction: row; gap: 20px; justify-content: center; width: 100%;">

                        <!-- 左側欄位：防具類 -->
                        <div class="equipment-column" style="display: flex; flex-direction: column; gap: 15px;">
                            <!-- 頭盔 -->
                            <div class="equip-slot" id="visual-slot-helmet" title="頭盔">
                                <div class="slot-content">無</div>
                                <div class="slot-bg"></div>
                            </div>
                            <!-- 胸甲 -->
                            <div class="equip-slot" id="visual-slot-armor" title="胸甲">
                                <div class="slot-content">無</div>
                                <div class="slot-bg"></div>
                            </div>
                            <!-- 護脛 -->
                            <div class="equip-slot" id="visual-slot-greaves" title="護脛">
                                <div class="slot-content">無</div>
                                <div class="slot-bg"></div>
                            </div>
                        </div>

                        <!-- 右側欄位：武器飾品類 -->
                        <div class="equipment-column" style="display: flex; flex-direction: column; gap: 15px;">
                            <!-- 武器 -->
                            <div class="equip-slot" id="visual-slot-weapon" title="武器">
                                <div class="slot-content">無</div>
                                <div class="slot-bg"></div>
                            </div>
                            <!-- 項鍊 -->
                            <div class="equip-slot" id="visual-slot-necklace" title="項鍊">
                                <div class="slot-content">無</div>
                                <div class="slot-bg"></div>
                            </div>
                            <!-- 戒指 -->
                            <div class="equip-slot" id="visual-slot-ring" title="戒指">
                                <div class="slot-content">無</div>
                                <div class="slot-bg"></div>
                            </div>
                        </div>

                    </div>
                </div>

                <div id="backpack-content-panel" class="panel" style="display: none; padding-top: 0;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; margin-top: 10px;">
                        <h3 style="margin-top: 0; margin-bottom: 0;">🎒 背包道具</h3>
                        <button id="close-inventory-btn"
                            style="background-color: #666; width: auto; min-width: 100px; margin: 0;">關閉背包</button>
                    </div>

                    <div id="inventory-list">目前沒有物品。</div>

                    <div id="materials-section"
                        style="margin-top: 20px; border-top: 1px solid #ddd; padding-top: 10px;">
                        <h4>📦 販售素材</h4>
                        <div id="material-inventory-list">素材清單載入中...</div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Achievement System Modal -->
    <div id="achievements-modal-backdrop"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); justify-content: center; align-items: center; z-index: 1005;">
        <div id="achievements-panel"
            style="display: block !important; background: #1a1515; border: 3px solid #e67e22; padding: 30px; border-radius: 10px; max-width: 900px; width: 90%; max-height: 85vh; overflow-y: auto; box-shadow: 0 0 20px rgba(230, 126, 34, 0.4);">
            <h3 style="color: #e67e22; text-align: center; margin-top: 0;">🏆 成就系統</h3>
            <p id="achievements-progress"
                style="color: #f39c12; font-weight: bold; margin-bottom: 10px; text-align: center;">已解鎖: 0/16</p>

            <div id="achievement-filters"
                style="margin-bottom: 15px; display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;">
                <button class="achievement-filter active" data-category="all"
                    onclick="window.achievementCategoryClick(this)">全部</button>
                <button class="achievement-filter" data-category="EXPLORATION"
                    onclick="window.achievementCategoryClick(this)">🗺️ 探索</button>
                <button class="achievement-filter" data-category="COMBAT"
                    onclick="window.achievementCategoryClick(this)">⚔️ 戰鬥</button>
                <button class="achievement-filter" data-category="WEALTH"
                    onclick="window.achievementCategoryClick(this)">💰 財富</button>
                <button class="achievement-filter" data-category="COLLECTION"
                    onclick="window.achievementCategoryClick(this)">📦 收藏</button>
            </div>

            <div id="achievement-tier-filters"
                style="margin-bottom: 15px; display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;">
                <button class="achievement-tier-filter active" data-tier="all"
                    onclick="window.achievementTierClick(this)">全部難度</button>
                <button class="achievement-tier-filter" data-tier="COMMON"
                    onclick="window.achievementTierClick(this)">🟢 普通</button>
                <button class="achievement-tier-filter" data-tier="RARE" onclick="window.achievementTierClick(this)">🔵
                    稀有</button>
                <button class="achievement-tier-filter" data-tier="EPIC" onclick="window.achievementTierClick(this)">🟣
                    史詩</button>
                <button class="achievement-tier-filter" data-tier="LEGENDARY"
                    onclick="window.achievementTierClick(this)">🟠 傳說</button>
                <button class="achievement-tier-filter" data-tier="GOD" onclick="window.achievementTierClick(this)">🔴
                    神話</button>
            </div>


            <div id="achievements-list"
                style="display: flex; flex-direction: column; gap: 10px; width: 100%; height: 500px; padding: 10px; background: rgba(0,0,0,0.2); overflow-y: auto; flex-shrink: 0;">
                <!-- Achievement items will be dynamically generated here -->
            </div>
            <button id="close-achievements-btn" onclick="window.closeAchievements()"
                style="margin-top: 15px; display: block; margin-left: auto; margin-right: auto;">關閉成就</button>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmation-modal-backdrop"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); justify-content: center; align-items: center; z-index: 1010;">
        <div id="confirmation-panel"
            style="display: block; background: #1a1515; border: 3px solid #e67e22; padding: 30px; border-radius: 10px; max-width: 500px; width: 90%; box-shadow: 0 0 20px rgba(230, 126, 34, 0.4); text-align: center;">
            <h3 id="confirmation-title" style="color: #e67e22; margin-top: 0; font-size: 1.5em;">確認</h3>
            <p id="confirmation-content" style="color: #ddd; margin: 20px 0; font-size: 1.1em; line-height: 1.5;">...
            </p>
            <div style="display: flex; justify-content: center; gap: 20px; margin-top: 30px;">
                <button id="confirmation-confirm-btn"
                    style="background: linear-gradient(#27ae60, #2ecc71); padding: 10px 30px; font-size: 1.1em; border: 2px solid #2ecc71;">確定</button>
                <button id="confirmation-cancel-btn"
                    style="background: #e74c3c; padding: 10px 30px; font-size: 1.1em; border: 2px solid #c0392b;">取消</button>
            </div>
        </div>
    </div>

    <script type="module" src="main.js"></script>
</body>